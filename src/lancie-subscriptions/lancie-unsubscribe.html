<script type="module" src="../../../../@polymer/polymer/polymer.js"></script>
<script type="module" src="../../../../lancie-ajax/lancie-ajax.js"></script>
<script type="module" src="../../../../lancie-error/lancie-error.js"></script>
<script type="module" src="../../../../lancie-card/lancie-card.js"></script>

<dom-module id="lancie-unsubscribe">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <lancie-ajax id="ajax" refurl="subscriptions/[[id]]" method="DELETE" on-lancie-ajax="handleResponse"></lancie-ajax>

    <lancie-card heading="Unsubscribe">
      <div class="card-content">
        <lancie-error id="status"></lancie-error>
      </div>
    </lancie-card>

  </template>
  <script type="module">
import '../../../../@polymer/polymer/polymer.js';
import '../../../../lancie-ajax/lancie-ajax.js';
import '../../../../lancie-error/lancie-error.js';
import '../../../../lancie-card/lancie-card.js';
import { Element } from '../../../../@polymer/polymer/polymer-element.js';

class LancieUnsubscribe extends Element {
  static get is() {
    return 'lancie-unsubscribe';
  }

  static get properties() {
    return {
      id: String,
      success: Boolean
    };
  }

  constructor() { super(); }

  ready() {
    super.ready();
    this.$.status.setInfo('Unsubscribing...');
    this.id = window.location.search.split('id=')[1];
    if (!isNaN(this.id)) {
        this.$.ajax.generateRequest();
    } else {
      this.$.status.setError('Could not unsubscribe. Please try again.');
    }
  }

  handleResponse(e, request) {
    if (request.succeeded) {
      this.$.status.setSuccess('Successfully unsubscribed!');
    } else {
      if (request.request.status=== 404) {
        this.$.status.setWarning('This email address has already been unsubscribed, or was not found in the database.');
      } else {
        this.$.status.setError('Could not unsubscribe. Please try again.');
      }
    }
  }
}

customElements.define(LancieUnsubscribe.is, LancieUnsubscribe);
</script>
</dom-module>
